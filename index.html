<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>iamri</title>
<style>
  :root { --muted: rgba(255,255,255,0.25); --bg: #000; --fg:#fff; }
  html,body{height:100%;margin:0;background:var(--bg);color:var(--fg);font-family:Poppins,Arial,Helvetica,sans-serif;overflow:hidden}
  .center-stage{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;width:100%;padding:20px;box-sizing:border-box}
  #dayText{font-size:80px;text-shadow:0 0 12px rgba(255,255,255,0.35);opacity:0;transition:opacity .8s}
  #text{font-size:26px;text-align:center;max-width:900px;margin-top:18px;opacity:0;transition:opacity 1s}
  #imageContainer{display:flex;gap:24px;align-items:center;justify-content:center;margin-top:18px}
  #imageContainer img{max-width:420px;max-height:320px;border-radius:12px;opacity:0;transition:opacity .8s}
  #buttons{margin-top:28px;opacity:0;transition:opacity .6s}
  .choiceButton{border:2px solid rgba(255,255,255,0.18);background:transparent;color:#fff;padding:12px 28px;border-radius:10px;font-size:20px;cursor:pointer;box-shadow:0 0 10px rgba(255,255,255,0.06)}
  .choiceButton:hover{transform:scale(1.04);box-shadow:0 0 22px rgba(255,255,255,0.12)}

  /* scene2 */
  #scene2{display:none;position:fixed;inset:0;background:#000;z-index:10;overflow:auto}
  .wrap{box-sizing:border-box;max-width:1200px;margin:0 auto;padding:22px;display:flex;flex-direction:column;height:100%}
  .topbar{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
  .title{font-size:20px;font-weight:700}
  .subtitle{color:var(--muted);font-size:13px}
  .stage{display:flex;gap:16px;flex:1;align-items:stretch}
  .col{flex:1;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:12px;border-radius:12px;overflow:auto}
  .col h3{margin:0 0 8px;color:var(--muted);font-size:13px}
  .list{display:flex;flex-direction:column;gap:8px}
  .item{padding:10px;border-radius:10px;background:rgba(255,255,255,0.03);cursor:pointer;border:1px solid rgba(255,255,255,0.03);user-select:none;transition:all .18s}
  .item.dim{opacity:.35;transform:scale(.99)}
  .item.selected{box-shadow:inset 0 0 18px rgba(255,255,255,0.04)}
  .item.correct{box-shadow:0 0 16px rgba(0,255,140,0.16);border-color:rgba(0,200,120,0.6);outline:3px solid rgba(0,200,120,0.08)}
  .item.wrong{box-shadow:0 0 16px rgba(255,60,60,0.16);border-color:rgba(255,60,60,0.6);outline:3px solid rgba(255,60,60,0.08)}

  .center{width:480px;max-width:48%;min-width:260px;display:flex;flex-direction:column;align-items:center;justify-content:flex-start;gap:12px}
  .media-frame{width:100%;border-radius:12px;background:#111;padding:12px;display:flex;flex-direction:column;align-items:center;justify-content:flex-start;overflow:auto;min-height:120px}
  .media-frame img, .media-frame video{width:100%;height:auto;max-height:420px;object-fit:contain;border-radius:8px;margin-bottom:10px;display:block}
  .media-caption{color:var(--muted);text-align:center;font-size:14px;padding:6px 10px}

  .btn-row{display:flex;gap:10px}
  .ghost-btn{padding:8px 10px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:#fff;cursor:pointer}

  #creditsBg{position:fixed;inset:0;background:#000;opacity:0;display:none;z-index:60;transition:opacity 1s}
  #creditsOverlay{position:fixed;inset:0;display:none;align-items:center;justify-content:center;z-index:70;pointer-events:none}
  #creditsBox{max-width:780px;color:#fff;text-align:center;transform:translateY(60px);opacity:0;transition:transform 1s ease, opacity 1s ease}
  #creditsBox .inner{line-height:1.6;font-size:20px}
  .wrap.fade-out{transition:opacity 1.8s ease;opacity:0} 

  @media (max-width:900px){
    .stage{flex-direction:column}
    .center{width:100%}
    .media-frame{min-height:160px}
  }
</style>
</head>
<body>

<!-- –ê—É–¥–∏–æ –¥–ª—è —Ñ–æ–Ω–æ–≤–æ–π –º—É–∑—ã–∫–∏ -->
<audio id="bgMusic" src="final_music.mp3" loop preload="auto"></audio>

<!-- FIRST part: days + intro -->
<div class="center-stage" id="introStage">
  <div id="dayText">Day 1</div>
  <div id="text"></div>
  <div id="imageContainer"></div>
  <div id="buttons">
    <button class="choiceButton" id="btn1">–ò—Å–∫–∞—Ç—å —Å–º—ã—Å–ª –∂–∏–∑–Ω–∏</button>
    <button class="choiceButton" id="btn2">–°–æ–∑–¥–∞–π —Å–≤–æ–π</button>
  </div>
</div>

<!-- SECOND part: choice scene -->
<div id="scene2" aria-hidden="true">
  <div class="wrap" id="wrapInner">
    <div class="topbar">
      <div>
        <div class="title">–°–æ–∑–¥–∞–π —Å–≤–æ–π ‚Äî —Å–æ–µ–¥–∏–Ω—è–π –Ω–∏–∫–∏ –∏ —Ñ—Ä–∞–∑—ã</div>
        <div class="subtitle">–ù–∞–∂–º–∏ –Ω–∏–∫ ‚Üí –∑–∞—Ç–µ–º —Ñ—Ä–∞–∑—É.</div>
      </div>
      <div class="btn-row">
        <button id="btn-reset" class="ghost-btn">–ü–µ—Ä–µ–º–µ—à–∞—Ç—å</button>
        <button id="btn-exit" class="ghost-btn">–í–µ—Ä–Ω—É—Ç—å—Å—è</button>
      </div>
    </div>

    <div class="stage">
      <div class="col" id="leftCol">
        <h3>–ù–∏–∫–∏</h3>
        <div class="list" id="nickList"></div>
      </div>

      <div class="center">
        <div class="media-frame" id="mediaFrame">
          <div id="mediaPlaceholder" style="color:var(--muted);text-align:center;padding:10px;">
            –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø–∞—Ä–∞ –ø–æ–∫–∞–∂–µ—Ç —Ñ–æ—Ç–æ –∏–ª–∏ –≤–∏–¥–µ–æ –∑–¥–µ—Å—å.<br><span style="font-size:12px;color:var(--muted)">–ö–ª–∏–∫ –ø–æ —ç–∫—Ä–∞–Ω—É –∑–∞–∫—Ä–æ–µ—Ç –º–µ–¥–∏–∞</span>
          </div>
        </div>
        <div class="media-caption" id="mediaCaption"></div>
      </div>

      <div class="col" id="rightCol">
        <h3>–§—Ä–∞–∑—ã</h3>
        <div class="list" id="phraseList"></div>
      </div>
    </div>
  </div>
</div>

<!-- credits overlay -->
<div id="creditsBg"></div>
<div id="creditsOverlay"><div id="creditsBox"><div class="inner" id="creditsInner"></div></div></div>

<script>
/* ===== –§–æ–Ω–æ–≤–∞—è –º—É–∑—ã–∫–∞ –ø–æ—Å–ª–µ –∫–ª–∏–∫–∞ ===== */
const bgMusic = document.getElementById('bgMusic');
bgMusic.volume = 0.01;
function startMusicOnClick(){
  bgMusic.play().catch(()=>{});
  document.body.removeEventListener('click', startMusicOnClick);
}
document.body.addEventListener('click', startMusicOnClick);

/* ===== CODEWORD check ===== */
window.onload = function() {
  let code = prompt("–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥–æ–≤–æ–µ —Å–ª–æ–≤–æ");
  if(code !== "–¥–∞—É–Ω") {
    alert("–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω");
    document.body.innerHTML = "<h1 style='color:white;text-align:center;margin-top:40vh;'>–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω</h1>";
    return;
  }

  animateDays();
}

/* ================== FIRST: days & intro & story ================== */
const dayText = document.getElementById('dayText');
const textEl = document.getElementById('text');
const imageContainer = document.getElementById('imageContainer');
const buttons = document.getElementById('buttons');
const btn1 = document.getElementById('btn1');
const btn2 = document.getElementById('btn2');
const scene2 = document.getElementById('scene2');
const wrapInner = document.getElementById('wrapInner');

let currentDay = 1;
const maxDays = 365;
let dayInterval = 300;

function animateDays(){
  function next(){
    dayText.textContent = "Day " + currentDay;
    dayText.style.opacity = 1;
    currentDay++;
    if(dayInterval > 20) dayInterval *= 0.98;
    if(currentDay <= maxDays) setTimeout(next, dayInterval);
    else {
      dayText.textContent = "Day X";
      setTimeout(()=>{
        dayText.style.transition = "opacity 4s ease-in-out";
        dayText.style.opacity = 0;
        setTimeout(showStory, 4000);
      }, 500);
    }
  }
  setTimeout(()=>{ dayText.style.opacity = 1; next(); }, 5000);
}

const story = [
  { text: "–° –∫–∞–∂–¥—ã–º –≥–æ–¥–æ–º –Ω–∞–º –Ω—É–∂–Ω–æ –ø—Ä–∏–Ω–∏–º–∞—Ç—å –≤—Å–µ –±–æ–ª—å—à–µ –≤–∞–∂–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π...", images: [] },
  { text: "–ò –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º –∏–∑ –Ω–∞—Å –≤—Å—Ç–∞–µ—Ç –≤–∞–∂–Ω—ã–π –≤—ã–±–æ—Ä...", images: [] },
  { text: "–ù–∞–ø—Ä–∏–º–µ—Ä: –ü–∞–∫ –ë–æ–≥–æ–º –∏–ª–∏ –∂–µ –õ–∏ –ß–æ–Ω –°–æ–∫...", images: ["images/pakbogom.jpg","images/leejongsuk.jpg"] },
  { text: "–ê–ª–∏—Å–µ–Ω: –æ–π..", images: ["images/alisa.jpg"] },
  { text: "–ü–æ–µ—Ö–∞—Ç—å –≤ –ú–æ—Å–∫–≤—É –∏–ª–∏ –ö–∏—Ç–∞–π...", images: [] },
  { text: "–û–±–æ—Å—Ä–∞—Ç—å –±—ã–≤—à–µ–≥–æ –ø–æ–¥—Ä—É–≥ –∏–ª–∏ –Ω–µ—Ç...", images: [] },
  { text: "–ò –ø–µ—Ä–µ–¥ iamri –≤—Å—Ç–∞–µ—Ç –≤—ã–±–æ—Ä —Ç–æ–∂–µ...", images: [] }
];
let storyIndex = 0;
function showStory(){
  if(storyIndex >= story.length){
    // show buttons after a pause
    setTimeout(()=> buttons.style.opacity = 1, 5000);
    return;
  }
  const cur = story[storyIndex];
  textEl.textContent = cur.text;
  textEl.style.opacity = 0;
  imageContainer.innerHTML = '';
  if(cur.images.length){
    cur.images.forEach(src=>{
      const img = document.createElement('img');
      img.src = src;
      img.style.opacity = 0;
      imageContainer.appendChild(img);
    });
  }
  setTimeout(()=>{
    textEl.style.transition = 'opacity 1s ease-in-out';
    textEl.style.opacity = 1;
    const imgs = imageContainer.querySelectorAll('img');
    imgs.forEach(img => { img.style.transition = 'opacity 1s ease-in-out'; img.style.opacity = 1; });
    setTimeout(()=>{
      textEl.style.transition = 'opacity 3s ease-in-out';
      imgs.forEach(img => img.style.transition = 'opacity 3s ease-in-out');
    }, 2000);
    setTimeout(()=>{
      textEl.style.opacity = 0;
      imgs.forEach(img => img.style.opacity = 0);
      setTimeout(()=>{ storyIndex++; showStory(); }, 5000);
    }, 4000);
  }, 100);
}

btn1.addEventListener('click', ()=>{
  const clickAudio = new Audio('click_sound.mp3');
  clickAudio.volume = 0.08;
  clickAudio.play().catch(()=>{});
  location.reload();
});
btn2.addEventListener('click', ()=>{
  const fadeEl = document.createElement('div');
  fadeEl.style.position = 'fixed';
  fadeEl.style.left = 0; fadeEl.style.top = 0; fadeEl.style.right = 0; fadeEl.style.bottom = 0;
  fadeEl.style.background = '#000'; fadeEl.style.opacity = '0'; fadeEl.style.zIndex = 20;
  fadeEl.style.transition = 'opacity 0.8s';
  document.body.appendChild(fadeEl);
  requestAnimationFrame(()=> fadeEl.style.opacity = '0.9');
  setTimeout(()=>{
    scene2.style.display = 'block';
    fadeEl.style.opacity = '0';
    setTimeout(()=> document.body.removeChild(fadeEl), 900);
    initScene();
  }, 900);
});

/* ================== SECOND: pairs, lists, media ================== */
const pairs = [
  { nick:"whxducky", text:"–ë—É–¥—å —Ç–∞–∫–æ–π –∂–µ –±–æ–ª—Ç—É—à–∫–æ–π –∫–∞–∫ –∫–æ–≥–¥–∞ –º—ã –∏–Ω–æ–≥–¥–∞ —Å–ø–ª–µ—Ç–Ω–∏—á–∞–µ–º.", files:{images:["images/whxducky.jpg"]} },
  { nick:"e_kkaterina", text:"–û—Å—Ç–∞–≤–∞–π—Å—è —Ç–∞–∫–æ–π –∂–µ —Ü–µ–ª–µ—É—Å—Ç—Ä–µ–º–ª–µ–Ω–Ω–æ–π, –∫–∞–∫ –≤ —Ç–µ –¥–Ω–∏, –∫–æ–≥–¥–∞ –º—ã –ø–æ —Ç—Ä–∏ —á–∞—Å–∞ –∏—Å–∫–∞–ª–∏ –∞–ª–º–∞–∑—ã –≤ —à–∞—Ö—Ç–∞—Ö.", files:{images:["images/e_kkaterina.jpg"]} },
  { nick:"aliska117", text:"–ü—Ä–æ–¥–æ–ª–∂–∞–π –∂–∏—Ç—å –∏ –∫–∞–π—Ñ–æ–≤–∞—Ç—å, –∞ –Ω–µ –æ–ø—Ä–∞–≤–¥—ã–≤–∞—Ç—å —á—å–∏-–ª–∏–±–æ –æ–∂–∏–¥–∞–Ω–∏—è. –û—Å—Ç–∞–≤–∞–π—Å—è —Ç–∞–∫–æ–π –∂–µ –¥—É—à–µ–≤–Ω–æ–π –∏ –ø—Ä–æ–Ω–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–π –∫–∞–∫ –≤ —Ç–æ—Ç –¥–µ–Ω—å, –∫–æ–≥–¥–∞ –º—ã —Ç–∞–Ω—Ü–µ–≤–∞–ª–∏ —Ç–∞–Ω–µ—Ü –∏–∑ –¥–Ω–µ–≤–Ω–∏–∫–æ–≤ –≤–∞–º–ø–∏—Ä–∞ –ø–æ–¥ –ª–∏–≤–Ω–µ–º!", files:{videos:["videos/aliska117.mp4"]} },
  { nick:"ALICEE_N", text:"–û—Å—Ç–∞–≤–∞–π—Å—è —Ç–∞–∫–æ–π –∂–µ –∑–∞–±–æ—Ç–ª–∏–≤–æ–π, –∫–∞–∫ –∫–æ–≥–¥–∞ –ø—Ä–∏—Ö–æ–¥–∏–ª–∞ –¥–∞—Ä–∏—Ç—å –º–Ω–µ —Ü–≤–µ—Ç–æ–∫, –≤—Å—Ç—Ä–µ—á–∞—è —Å —É–Ω–∏–∫–∞.", files:{videos:["videos/ALICEE_N.mp4"]} },
  { nick:"eemilixx", text:"–û—Å—Ç–∞–≤–∞–π—Å—è —Ç–∞–∫–æ–π –∂–µ —Å—á–∞—Å—Ç–ª–∏–≤–æ–π, –∫–∞–∫ –≤ –¥–µ–Ω—å, –∫–æ–≥–¥–∞ —è –ø—Ä–∏–≤–µ–ª–∞ —Ç–µ–±—è –∫ –º–∏–Ω–∏ –∑–æ–æ–ø–∞—Ä–∫—É –Ω–∞ –ö—Ä–µ—Å—Ç–æ–≤—Å–∫–æ–ºü•π", files:{images:["images/eemilixx.jpg"]} },
  { nick:"utya_yu", text:"–ü—É—Å—Ç—å —Ç—ã –≤—Å–µ–≥–¥–∞ –±—É–¥–µ—à—å —Ç–∞–∫–æ–π –∂–µ —Ü–µ–ª–µ—É—Å—Ç—Ä–µ–º–ª–µ–Ω–Ω–æ–π, –≤–¥–æ—Ö–Ω–æ–≤–ª–µ–Ω–Ω–æ–π –∏ –Ω–µ—É–Ω—ã–≤–∞—é—â–µ–π –∫–∞–∫ –ø–æ—Å–ª–µ —à–µ—Å—Ç–∏ —á–∞—Å–æ–≤–æ–π –¥–æ—Ä–æ–≥–∏ –∫–æ –º–Ω–µ (–≤–º–µ—Å—Ç–æ —Ç—Ä–µ—Ö—á–∞—Å–æ–≤–æ–π)", files:{images:["images/utya_yu.jpg"]} },
  { nick:"imtvnk", text:"–û—Å—Ç–∞–≤–∞–π—Å—è —Ç–∞–∫–æ–π –∂–µ —Ç–µ–ø–ª–æ–π –∏ –∂–∏–∑–Ω–µ—Ä–∞–¥–æ—Å—Ç–Ω–æ–π, –∫–∞–∫ —Ç–µ –≤–µ—á–µ—Ä–∞, –∫–æ—Ç–æ—Ä—ã–µ –º—ã –ø—Ä–æ–≤–æ–¥–∏–ª–∏ –≤–º–µ—Å—Ç–µ", files:{images:["images/imtvnk.jpg"]} },
  { nick:"mashaavovk", text:"–û—Å—Ç–∞–≤–∞–π—Å—è —Ç–∞–∫–æ–π –∂–µ –≤–µ—Å–µ–ª–æ–π –∏ –æ–∑–æ—Ä–Ω–æ–π, –∫–∞–∫ –≤ –Ω–æ—á—å, –∫–æ–≥–¥–∞ –º—ã –≤ –Ω–æ–≤–æ–≥–æ–¥–Ω–∏—Ö –ø–∏–∂–∞–º–∞—Ö –≤—ã—Ö–æ–¥–∏–ª–∏ –≤ –º–∞–≥–∞–∑–∏–Ω, –∞ –ø–æ—Ç–æ–º —Å–º–æ—Ç—Ä–µ–ª–∏ —ç–∫—Å–∞–π–ª–∞. –û—Å—Ç–∞–≤–∞–π—Å—è —Ç–∞–∫–æ–π –∂–µ –ª—é–±–æ–∑–Ω–∞—Ç–µ–ª—å–Ω–æ–π, –∫–∞–∫ –≤ –¥–µ–Ω—å, –∫–æ–≥–¥–∞ –º—ã –æ–±–æ—à–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–Ω—ã—Ö –º—É–∑–µ–µ–≤ –∏ –ø–æ–∑–Ω–∞–∫–æ–º–∏–ª–∏—Å—å —Å –º–∏–ª–æ–π –∂–µ–Ω—â–∏–Ω–æ–π —ç–∫—Å–∫—É—Ä—Å–æ–≤–æ–¥–æ–º‚ù§Ô∏è", files:{images:["images/mashaavovk.jpg"]} },
  { nick:"i_OLYA", text:"–ü—É—Å—Ç—å —Ç–≤–æ—è –∂–∏–∑–Ω—å —Ç–∞–∫–∂–µ –æ–∫—Ä–∞—à–∏–≤–∞–µ—Ç—Å—è –∫—Ä–∞—Å–∫–∞–º–∏, –∫–∞–∫ –Ω–∞—à —Ö–æ–ª—Å—Ç —Å —Ä—É–∫–∞–º–∏.", files:{images:["images/i_OLYA.jpg"]} },
  { nick:"varrvarrass", text:"–û—Å—Ç–∞–≤–∞–π—Å—è —Ç–∞–∫–æ–π –∂–µ –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ–π –∏ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–π, –∫–∞–∫ –≤ —Ç–æ—Ç –º–æ–º–µ–Ω—Ç, –∫–æ–≥–¥–∞ –∞–ª–∏—Å–µ–Ω —Ä–µ—à–∏–ª–∞ —É—Å—Ç—Ä–æ–∏—Ç—å –∫–≤–µ—Å—Ç-–∏—Å—Ç–æ—Ä–∏—é —Å –≥–æ–ª–æ—Å–æ–≤—ã–º–∏ –∫–∞–∂–¥–æ–º—É –∏–∑ –±–µ–±–∞..", files:{images:["images/varrvarrass.jpg"]} },{ nick:"NIKUSIK0", text:"–û—Å—Ç–∞–≤–∞–π—Å—è —Ç–∞–∫–æ–π –∂–µ –≤–µ—Å–µ–ª–æ–π –∏ —ç–Ω–µ—Ä–≥–∏—á–Ω–æ–π, –∫–∞–∫ –≤ –¥–µ–Ω—å, –∫–æ–≥–¥–∞ —Ç–∞–Ω—Ü–µ–≤–∞–ª–∞ –¥–ª—è –º–µ–Ω—è –ø–æ–¥ –∫—É—Ä—Å–µ–¥–∞.", files:{videos:["videos/NIKUSIK0.mp4"]} },
  { nick:"OGONEKK101", text:"–° –¥–Ω–µ–º —Ä–æ–∂–¥–µ–Ω–∏—è", files:{images:["images/OGONEKK101.jpg"]} },
  { nick:"downt1povniz", text:"–ñ–µ–ª–∞—é —Ç–µ–±–µ –≤—Å–µ–≥–¥–∞ –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è —Ç–∞–∫–æ–π –∂–µ —ç–Ω–µ—Ä–≥–∏—á–Ω–æ–π –∏ —Å—Ç–æ–π–∫–æ–π, –∫–∞–∫ –≤ —Ç–æ—Ç –¥–µ–Ω—å –≤ —Ä–æ–≤–µ—Å–Ω–∏–∫–µ :)", files:{images:["images/downt1povniz.jpg"]} }
];

let leftItems = [], rightItems = [], selectedNick = null, selectedPhrase = null;
let matched = new Set();

const nickList = document.getElementById('nickList');
const phraseList = document.getElementById('phraseList');
const mediaFrame = document.getElementById('mediaFrame');
const mediaCaption = document.getElementById('mediaCaption');
const btnReset = document.getElementById('btn-reset');
const btnExit = document.getElementById('btn-exit');

function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; } }

function initScene(){
  leftItems = pairs.map((p,i)=>({nick:p.nick, idx:i}));
  rightItems = pairs.map((p,i)=>({text:p.text, idx:i}));
  shuffle(leftItems); shuffle(rightItems);
  renderLists();
  matched.clear(); selectedNick=null; selectedPhrase=null;
  clearMedia();
  wrapInner.classList.remove('fade-out');
  document.querySelector('.wrap').style.opacity = 1;
}

function renderLists(){
  nickList.innerHTML=''; phraseList.innerHTML='';
  leftItems.forEach(li=>{
    const el = document.createElement('div');
    el.className = 'item';
    el.textContent = li.nick;
    el.dataset.idx = li.idx;
    el.addEventListener('click', ()=> onNickClick(li.idx, el));
    nickList.appendChild(el);
  });
  rightItems.forEach(ri=>{
    const el = document.createElement('div');
    el.className = 'item';
    el.textContent = ri.text;
    el.dataset.idx = ri.idx;
    el.addEventListener('click', ()=> onPhraseClick(ri.idx, el));
    phraseList.appendChild(el);
  });
}

function onNickClick(idx, el){
  if(matched.has(idx)) return;
  selectedNick = idx;
  document.querySelectorAll('#nickList .item').forEach(it=>{
    if(+it.dataset.idx === idx){ it.classList.add('selected'); it.classList.remove('dim'); }
    else it.classList.add('dim');
  });
  selectedPhrase = null;
  document.querySelectorAll('#phraseList .item').forEach(it=>it.classList.remove('selected','dim'));
}

function onPhraseClick(idx, el){
  if(matched.has(idx)) return;
  selectedPhrase = idx;
  document.querySelectorAll('#phraseList .item').forEach(it=>{
    if(+it.dataset.idx === idx){ it.classList.add('selected'); it.classList.remove('dim'); }
    else it.classList.add('dim');
  });
  if(selectedNick !== null) checkPair(selectedNick, selectedPhrase);
  else document.querySelectorAll('#nickList .item').forEach(it=>it.classList.add('dim'));
}

btnReset.addEventListener('click', ()=> initScene());
btnExit.addEventListener('click', ()=> { window.location.reload(); });

function clearMedia(){
  mediaFrame.innerHTML = '<div id="mediaPlaceholder" style="color:var(--muted);text-align:center;padding:10px">–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø–∞—Ä–∞ –ø–æ–∫–∞–∂–µ—Ç —Ñ–æ—Ç–æ –∏–ª–∏ –≤–∏–¥–µ–æ –∑–¥–µ—Å—å.<br><span style="font-size:12px;color:var(--muted)">–ö–ª–∏–∫ –ø–æ —ç–∫—Ä–∞–Ω—É –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –º–µ–¥–∏–∞</span></div>';
  if(mediaCaption) mediaCaption.textContent = '';
}

function checkPair(nickIdx, phraseIdx){
  const nickEl = document.querySelector('#nickList .item[data-idx="'+nickIdx+'"]');
  const phraseEl = document.querySelector('#phraseList .item[data-idx="'+phraseIdx+'"]');

  if(nickIdx === phraseIdx){
    matched.add(nickIdx);
    nickEl.classList.add('correct');
    phraseEl.classList.add('correct');
    nickEl.classList.remove('selected','dim');
    phraseEl.classList.remove('selected','dim');

    const p = pairs[nickIdx];
    mediaFrame.innerHTML = '';
    if(p.files.images){
      p.files.images.forEach(src=>{
        const img = document.createElement('img');
        img.src = src;
        mediaFrame.appendChild(img);
      });
    }
    if(p.files.videos){
      p.files.videos.forEach(src=>{
        const vid = document.createElement('video');
        vid.src = src;
        vid.controls = true;
        vid.style.maxHeight = "420px";
        mediaFrame.appendChild(vid);
      });
    }
    mediaCaption.textContent = p.text;

    if(matched.size === pairs.length){
      setTimeout(()=> startFinalTransition(), 2200);
    }
  } else {
    nickEl.classList.add('wrong');
    phraseEl.classList.add('wrong');
    setTimeout(()=>{ nickEl.classList.remove('wrong'); phraseEl.classList.remove('wrong'); }, 900);
    setTimeout(()=>{ document.querySelectorAll('.item').forEach(it=>it.classList.remove('selected','dim')); }, 700);
  }
}

/* ========== Final transition: fade scene then show credits ========== */
const creditsBg = document.getElementById('creditsBg');
const creditsOverlay = document.getElementById('creditsOverlay');
const creditsBox = document.getElementById('creditsBox');
const creditsInner = document.getElementById('creditsInner');

function startFinalTransition(){
  wrapInner.classList.add('fade-out');

  setTimeout(()=> {
    creditsBg.style.display = 'block';
    creditsBg.style.opacity = 0.8;

    creditsOverlay.style.display = 'flex';
    creditsBox.style.opacity = 1;
    creditsBox.style.transform = 'translateY(100vh)'; // —Å—Ç–∞—Ä—Ç —Å–Ω–∏–∑—É
    creditsBox.style.transition = 'transform 36s linear, opacity 1s ease';

    // –∑–∞–¥–∞—ë–º –∫–æ–Ω—Ç–µ–Ω—Ç
    creditsInner.innerHTML = `
       <div style="font-weight:700;font-size:26px;margin-bottom:8px">–î–æ—Ä–æ–≥–∞—è –†–∏—Ç–∞.</div>
      <div>–¢—ã –∏ –±–µ–∑ –Ω–∞—à–∏—Ö —Å–ª–æ–≤ –∑–Ω–∞–µ—à—å, –∫–∞–∫–∞—è —Ç—ã –∑–∞–º–µ—á–∞—Ç–µ–ª—å–Ω–∞—è. –ú–µ–Ω—å—à–µ–µ, —á—Ç–æ –º—ã –º–æ–∂–µ–º —Å–¥–µ–ª–∞—Ç—å –≤–º–µ—Å—Ç–µ ‚Äì —ç—Ç–æ –Ω–∞–ø–æ–º–Ω–∏—Ç—å —Ç–µ–±–µ, –∫–∞–∫ –º—ã —Å—á–∞—Å—Ç–ª–∏–≤—ã, –∫–æ–≥–¥–∞ —Ç—ã —Ä—è–¥–æ–º.</div>
      <div style="height:10px"></div>
      <div>–õ—é–±–∏ —Å–µ–±—è, –∂–∏–∑–Ω—å –∏ –Ω–µ –∑–∞–±—ã–≤–∞–π, —á—Ç–æ —Å —Ç–æ–±–æ–π —Ä—è–¥–æ–º –ª—é–¥–∏, –∫–æ—Ç–æ—Ä—ã–º —Ç—ã –≤–∞–∂–Ω–∞.</div>
      <div style="height:10px"></div>
      <div style="font-weight:700;margin-top:12px">–° –¥–Ω–µ–º —Ä–æ–∂–¥–µ–Ω–∏—è!</div>
      <div style="height:14px"></div>
      <div>–ø—Ä–æ—Ö—Ä–∞–º–∏—Å—Ç ‚Äì OGONEEEEEEKK</div>
      <div>–∏–¥–µ–π—â–∏–∫ —Ö—É–µ–≤ ‚Äì ALICEEEEEN</div>
      <div>–¥–µ–±–∏–ª—ã ‚Äì EKATERIIIIINA  & IOOOOOLYA & NIKUUUUUUSIK</div>
      <div style="height:18px"></div>
      <div><img src="yamriluva.png" alt="yamriluva" style="width:120px;border-radius:8px;margin-top:8px"></div>
    `;

    // –ø—Ä–æ–∏–≥—Ä—ã–≤–∞–µ–º –º—É–∑—ã–∫—É
    const audio = new Audio('final_music.mp3');
    audio.volume = 0.03;
    audio.play().catch(()=>{});

    // —á–µ—Ä–µ–∑ RAF –∑–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é
    requestAnimationFrame(()=>{
      creditsBox.style.transform = 'translateY(-65vh)';
    });

    setTimeout(()=>{
      creditsBox.style.opacity = 0;
      creditsBg.style.opacity = 0;
      setTimeout(()=>{
        creditsOverlay.style.display = 'none';
        creditsBg.style.display = 'none';
      }, 900);
    }, 36000);

  }, 1800);
}
</script>
</body>

</html>

